# Junie コーディングルール（MergePDF リポジトリ）

本ドキュメントは、AI エージェント Junie および人間のコントリビューターが本リポジトリ（Java 21 / Maven）に変更を加える際の基準を定めます。最小変更での改善、読みやすさ、保守性、再現性の高い開発を目的とします。

対象バージョン
- Java: 21
- ビルド: Maven（UTF-8）

1. 変更方針（Junie 運用ルール）
- 最小差分: 要件を満たすために必要最小限の変更/追加のみを行う。
- 透明性: 変更前に計画（Plan）を提示し、進捗は update_status で更新する。
- 検証: 可能な限り再現手順/テストを用意してから修正し、修正後に再実行して確認する。
- 既存方針尊重: 既存の構成（フォルダ構成・依存・ビルド）は不用意に変えない。変更が必要な場合は理由を明記。
- 安全性: 破壊的変更は避ける。互換性に影響がある場合は代替策・移行手順を提案し、明確に合意を得る。
- ドキュメント化: 公開 API の仕様変更や新規ツール導入時は README / 本ルールへの追記を行う。

2. 命名規則
- パッケージ: 全て小文字、組織・ドメインに従う（例: jp.goodenough.merge）。
- クラス/インターフェース: PascalCase（例: PdfMerger, MergeOptions）。
- メソッド/フィールド: lowerCamelCase（例: mergeFiles, inputPaths）。
- 定数: 全大文字 + アンダースコア（例: DEFAULT_BUFFER_SIZE）。
- ファイル名: クラス名と一致させる。テストは <ClassName>Test。

3. コードスタイル
- インデント: スペース 4。
- 行長: 120 桁目を目安に改行。
- 文字コード: UTF-8（pom.xml に従う）。
- 改行コード: LF。
- 波括弧: K&R（同一行で開き、独立行で閉じる）。
- import: 未使用 import を禁止。ワイルドカード import は基本禁止。順序は java.* → javax.* → org.* → com.* → プロジェクト内。
- 可視性: 可能な限り最小（private を基本）。フィールドは原則 private、必要に応じてアクセサ。
- 不変性: 可能な限り final を付与。メソッド引数やローカル変数にも検討。

4. ドキュメンテーション
- クラス/パブリックメソッドには Javadoc を記載（目的、パラメータ、戻り値、例外）。
- 複雑な処理には意図をコメントで補足（「なぜ」その実装か）。
- TODO は具体的（目的/期限/担当）に。無期限 TODO の増殖を避ける。

5. 例外・エラー処理
- チェック例外とランタイム例外の使い分けを明確に。API の契約違反は IllegalArgumentException 等。
- スロー/キャッチはできるだけ近い箇所で。例外の握りつぶし禁止（ログや再スローで文脈を保持）。
- finally / try-with-resources を用いてリソースリーク防止。
- メッセージはユーザー/運用が原因追跡できる内容に。

6. ロギング
- System.out.println ではなくログフレームワークを使用（将来的に導入する場合）。現状は簡易出力可だが本番用途に昇格する場合は SLF4J + 実装に移行。
- ログレベル方針: DEBUG=開発詳細, INFO=通常進行, WARN=復旧可能, ERROR=要対応。

7. Null/Optional/コレクション
- 参照に @Nullable/@NonNull（導入時）を活用。引数の検証を行う。
- Optional は戻り値で使用を優先。フィールドに Optional は基本禁止。
- コレクションはインターフェース型で受け渡し（List, Set, Map）。不変コレクションを優先。

8. 並行処理
- 共有可変状態は最小化し、スレッドセーフなデータ構造を使用。
- 同期制御は最小限にし、デッドロック・可視性・競合条件に注意。

9. ビルド/依存
- Maven 標準を守る。不要な依存は追加しない。スコープは適切に（compile/test/provided）。
- Java 21 に合わせる。ソース/ターゲットの変更が必要な場合は明示的に理由を記載。

10. テスト
- フレームワーク: JUnit 5（導入時）。
- 命名: メソッド名は何を検証するかが分かるように（例: mergeFiles_mergesInGivenOrder）。
- AAA（Arrange-Act-Assert）で構造化。外部 I/O は可能ならモック/一時ディレクトリを使用。
- テストデータは小さく再現性のあるものを用意。テストは自己完結に。

11. パフォーマンス/メモリ
- 不必要なコピー/文字列連結を避ける（StringBuilder/Stream を適切に）。
- I/O はバッファリング。大きなファイル処理ではストリーミングを優先。

12. セキュリティ
- 外部入力の検証を徹底。パス操作、コマンド実行、テンポラリファイルの扱いに注意。
- 依存の脆弱性は定期確認（導入時に Maven プラグイン検討）。

13. Git 運用
- ブランチ: main は常に安定。作業は feature/<短い要約>-<issue番号> などで。
- コミットメッセージ: Conventional Commits（例: feat:, fix:, docs:, refactor:, test:, build:, ci:, chore:, perf:）。
- PR: 小さく、1 目的。説明・スクリーンショット・再現手順・影響範囲・テスト結果を記載。

14. ファイル/フォルダ構成
- 標準 Maven 構成を踏襲。
- ユーティリティ/ドメイン/アプリケーション層を分離（規模拡大時）。

15. フォーマット/静的解析（将来導入）
- Spotless or Checkstyle で自動整形/検査を導入予定。導入時は pom.xml に設定を追加し、本ドキュメントにルールセットを追記。

付録A: PR チェックリスト
- 目的が明確か。
- 変更範囲が最小か。
- 命名/スタイル/可視性に一貫性があるか。
- 例外・リソースリーク対策があるか。
- ログ/メッセージが十分か。
- テスト（または再現手順）があるか。
- ドキュメント更新が必要なら実施済みか。

付録B: サンプル Javadoc
/**
 * PDF ファイルを結合します。
 * @param inputs 入力 PDF のパス（順序維持）
 * @param output 出力 PDF のパス（上書き可）
 * @throws IOException 入出力エラー
 */
public void mergeFiles(List<Path> inputs, Path output) throws IOException { /* ... */ }

備考
- 本ドキュメントはプロジェクトの実態に合わせて更新します。変更時は理由と適用範囲を明記してください。